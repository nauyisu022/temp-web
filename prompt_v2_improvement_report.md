# Prompt V2 迭代改进报告

> **迭代版本：** V1 → V2  
> **迭代日期：** 2026-02-11  

---

## 一句话总结

从 **"忠实提取原文"** 转向 **"生成搜索友好的关键词"**，指令精简 42%，预期搜索覆盖率提升 15-25%。

---

## 核心改进

| 改进项 | V1 | V2 | 效果 |
|-------|----|----|------|
| **指令长度** | 190 行 | 110 行 | 精简 42% |
| **Token 消耗** | 5200/商品 | 4000/商品 | 节省 23% |
| **指令矛盾** | 3 处 | 0 处 | 输出更一致 |
| **同义词扩展** | ❌ 不允许 | ✅ 允许 | 搜索覆盖 +15~25% |
| **输出格式** | 部分 JSON | 全部 JSON | 解析更可靠 |

---

## V1 的主要问题

1. **指令矛盾**：说"不要创造新词"，又说"可以排列组合"
2. **要求不现实**：没有竞品数据，却要求做竞品分析
3. **指令太长**：Step 3 有 190 行，模型注意力分散
4. **约束过严**：只能用原文词汇，限制了搜索覆盖

---

## V2 的设计原则

1. **搜索导向**：优先用消费者会搜索的词，允许同义词
2. **灵活度梯度**：brand 严格 > USP 允许同义词 > 长尾词最灵活
3. **精简指令**：用示例驱动，减少规则堆叠
4. **语言明确**：每个市场用当地语言（BR 用葡萄牙语，TW 用繁体中文）

---

## 具体改进内容

### Step 1: 用户画像 → 搜索意图

**主要变化：**
- 从分析"人口统计、消费心理"改为分析"用户会搜什么词"
- 输出从纯文本改为 JSON，下游解析更可靠

**示例对比：**

V1（纯文本）：
```
用户画像：25-40岁的年轻父母，中高收入...
选中Schema：材质, 容量, 加热制热...
```

V2（JSON）：
```json
{
  "user_intent": "寻找安全、便携的婴儿食品储存方案",
  "search_word_types": ["材质安全词", "容量规格词"],
  "selected_schema": ["材质", "容量", "安全保护"]
}
```

---

### Step 2: 关键词提取

**主要变化：**
- V1：只能用原文词汇，不能同义词
- V2：允许同义词扩展，覆盖更多搜索路径

**示例：**

商品原文："Bolsa de silicone para armazenamento"

V1 提取：
```
材质: ["silicone"]
用途: ["armazenamento"]
```

V2 提取：
```
材质: ["silicone", "silicone platina", "silicone alimentar"]
用途: ["armazenamento", "guardar comida", "conservar alimentos"]
```

---

### Step 3: 三层关键词（核心改进）

**主要变化：**

| 改进项 | V1 | V2 |
|-------|----|----|
| 指令长度 | 190 行 | 110 行 |
| 竞品分析 | 要求做竞品分析（无数据） | 移除 |
| USP 逻辑 | 避免通用特性 | 高频搜索词保留 |
| 长尾词数量 | ≤4 个 | 5-6 个 |
| 指令矛盾 | 3 处 | 0 处 |

**V1 的指令矛盾：**
- 说"不要创造新词"，又说"可以排列组合"
- 说"brand 只放 1 个词"，示例却放了 2 个
- 说"不要翻译"，又要求"提供英文版本"

**V2 全部消除**

---

### Step 4: 候选评估

**主要变化：**

V1 评估维度：
```
准确性 30% + 吸引力 25% + 完整性 25% + 结构性 15% + 简洁性 5%
```

V2 评估维度：
```
语义准确性 30% + 搜索覆盖 30% + 完整性 25% + 结构规范 15%
```

**改进点：**
- 用"搜索覆盖"替换"吸引力"，更符合目标
- 移除"简洁性"（权重只有 5%，意义不大）
- 明确加权计算公式
- 定义 confidence 标准（high/medium/low）

---

## 预期效果

| 指标 | V1 基线 | V2 预期 | 说明 |
|------|--------|--------|------|
| **短语命中率** | 56.3% | 60~65% | ✅ 核心目标 |
| **一致率** | 35.8% | 30~35% | ⚠️ 可能下降（允许同义词） |
| **FactScore** | 67.8% | 60~65% | ⚠️ 可能下降（同义词不在原文） |
| **处理速度** | 基线 | +15~20% | ✅ Token 减少 23% |

---

## 风险与权衡

### 风险 1: FactScore 下降

**原因：** 同义词可能不在原文中

**示例：**
- 原文："Bolsa de silicone"
- V1："silicone"（FactScore 100%）
- V2："silicone", "silicone platina"（FactScore 50%）

**应对：** 如果下降超过 15%，调整同义词扩展程度

### 风险 2: 一致率下降

**原因：** 同义词导致与搜索词库完全匹配减少

**权衡：** 这是预期的。一致率下降但短语命中率提升，覆盖更多搜索路径

---

## 实施建议

### 第 1 步：小规模测试（100 条商品）
- 修改 `processor.py` 支持 V2
- 人工检查输出质量
- 调整同义词扩展程度

### 第 2 步：A/B 测试（500 条商品）
- 对比 V1 vs V2 指标
- 生成对比 dashboard
- 决定是否全量切换

### 第 3 步：全量部署
- 保留 V1 作为降级方案
- 持续监控线上指标

---

## 总结

**核心改进：**
- 指令精简 42%，Token 节省 23%
- 消除 3 处指令矛盾
- 允许同义词扩展，预期搜索覆盖率提升 15-25%

**权衡：**
- FactScore 可能下降 5-10%（同义词不在原文）
- 一致率可能下降 5-10%（同义词不完全匹配）

**建议：**
- 先小规模测试 100 条
- 再 A/B 测试 500 条
- 根据结果决定是否全量切换

---

**相关文档：**
- V1 问题分析：`prompts_analysis.md`
- V2 代码：`prompts_v2.py`
- 评估 Dashboard：`ksp_eval_dashboard.html`
